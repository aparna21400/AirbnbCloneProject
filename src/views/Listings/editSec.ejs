<% layout('layouts/boilerplate') -%>

    <div class="row">
        <div class="col-8 offset-2">

            <h3 style="margin-top: 5px;">Edit Your Listing</h3>
            <form method="POST" action="/listings/<%= listing._id%>?_method=PUT" enctype="multipart/form-data">

                <div class="mb-3; width: 100%;">
                    <label for="title" class="form-label">Title</label>
                    <input placeholder="Enter Title" class="form-control" value="<%= listing.title%>"
                        name="listing[title]">
                </div>

                <div class="mb-3">
                    <label for="description" class="form-label">Descriptin</label>
                    <textarea class="form-control" name="listing[description]"><%= listing.description%></textarea>
                </div>
                <div class="mb-3">
                    Original LIsting Image<br />
                    <img src="<%=originalImageUrl || listing.image || '/default.jpg' %>" alt="Listing Image"
                        style="width: 250px; height: auto; border-radius: 8px;">
                </div>

                <div class="mb-3">
                    <label for="image" class="form-label">Upload New Image</label>
                    <input class="form-control" type="file" name="listing[image]">
                </div>
                <div class="row">
                    <div class="mb-3">
                        <label for="price" class="form-label">Price</label>
                        <input class="form-control" type="number" value="<%= listing.price%>" name="listing[price]"
                            type="listing[number]">
                    </div>

                    <div class="mb-3 col-8">
                        <label for="country" class="form-label">Country</label>
                        <input class="form-control" value="<%= listing.country%>" name="listing[country]">
                    </div>
                </div>

                <div class="mb-3 ">
                    <label for="location" class="form-label">Location</label>
                    <input class="form-control" value=" <%=listing.location%>" name="listing[location]">
                </div>

                <!-- Category -->
                <div class="mb-3">
                    <label for="category" class="form-label">Category</label>
                    <select name="listing[category]" class="form-control" required>
                        <option value="">Select a category</option>
                        <option value="Mountains" <%=listing.category==='mountains' ? 'selected' : '' %>>Mountains
                        </option>
                        <option value="Arctic" <%=listing.category==='Arctic' ? 'selected' : '' %>>Arctic</option>
                        <option value="Farms" <%=listing.category==='Farms' ? 'selected' : '' %>>Farms</option>
                        <option value="Pools" <%=listing.category==='Pools' ? 'selected' : '' %>>Pools</option>
                        <option value="Beach" <%=listing.category==='Beach' ? 'selected' : '' %>>Beach</option>
                        <option value="Lounge" <%=listing.category==='Lounge' ? 'selected' : '' %>>Lounge</option>
                        <option value="Camping" <%=listing.category==='Camping' ? 'selected' : '' %>>Camping</option>
                        <option value="Castles" <%=listing.category==='Castles' ? 'selected' : '' %>>Castles</option>
                        <option value="Iconic cities" <%=listing.category==='Iconic cities' ? 'selected' : '' %>>Iconic
                            Cities</option>
                        <option value="Rooms" <%=listing.category==='Rooms' ? 'selected' : '' %>>Rooms</option>
                    </select>
                </div>

                <button class=" btn btn-dark"
                    style="margin-bottom: 10px; background-color: #274c14; border: none;">ADD</button>
            </form>
        </div>
    </div>
    <script>
        (() => {
            'use strict'

            const forms = document.querySelectorAll('.needs-validation')

            Array.from(forms).forEach(form => {
                form.addEventListener('submit', event => {
                    if (!form.checkValidity()) {
                        event.preventDefault()
                        event.stopPropagation()
                    }

                    form.classList.add('was-validated')
                }, false);
            });

            const msg = document.getElementById("reviewMessage");
            if (msg) {
                setTimeout(() => {
                    msg.classList.remove("show");
                    msg.classList.add("hide");
                }, 3000); // disappears after 3 seconds
            }
        })();
    </script>